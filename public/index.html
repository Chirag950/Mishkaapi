<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Control Panel</title>
</head>
<body>
  <h1>Control Panel</h1>
  <form id="boardForm">
    <label for="boardId">Board ID:</label>
    <input type="text" id="boardId" name="boardId" required>
    <button type="submit">Submit</button>
  </form>
  <div id="outputsContainer"></div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(() => {
      $('#boardForm').submit((event) => {
        event.preventDefault();
        const boardId = $('#boardId').val();
        renderOutputs(boardId);
      });
    });

    function renderOutputs(boardId) {
      const outputsContainer = $('#outputsContainer');
      outputsContainer.empty();

      $.get(`/outputs?id=${boardId}`, (outputs) => {
        if (outputs.length > 0) {
          outputs.forEach((output) => {
            const { boardId, outputIndex } = output;
            const outputContainer = $('<div>', { class: 'output-container' });
            const outputLabel = $('<label>').text(`Output ${outputIndex}`);
            const onButton = $('<button>', {
              class: 'on-button',
              text: 'ON',
              click: () => updateOutput(boardId, outputIndex, 'on')
            });
            const offButton = $('<button>', {
              class: 'off-button',
              text: 'OFF',
              click: () => updateOutput(boardId, outputIndex, 'off')
            });

            outputContainer.append(outputLabel, onButton, offButton);
            outputsContainer.append(outputContainer);
          });
        } else {
          const noOutputsMessage = $('<p>').text('No outputs defined for the selected board');
          outputsContainer.append(noOutputsMessage);
        }
      }).fail(() => {
        const errorMessage = $('<p>').text('Failed to retrieve outputs for the selected board');
        outputsContainer.append(errorMessage);
      });
    }

    function updateOutput(boardId, output, state) {
      const url = `/${state}?id=${boardId}&output=${output}`;
      $.get(url, (response) => {
        console.log(response);
      }).fail(() => {
        console.log('Failed to update output state');
      });
    }
  </script>
</body>
</html>
