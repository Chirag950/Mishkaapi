<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Control Panel</title>
</head>
<body>
  <h1>Control Panel</h1>
  <form id="boardForm">
    <label for="boardId">Board ID:</label>
    <input type="text" id="boardId" name="boardId" required>
    <button type="submit">Submit</button>
  </form>
  <div id="outputsContainer"></div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(() => {
      $('#boardForm').submit((event) => {
        event.preventDefault();
        const boardId = $('#boardId').val();
        fetchOutputs(boardId);
      });
    });

    async function fetchOutputs(boardId) {
      try {
        const response = await fetch(`/outputs?id=${boardId}`);
        if (response.ok) {
          const outputs = await response.json();
          renderOutputs(outputs);
        } else {
          throw new Error('Failed to fetch outputs');
        }
      } catch (error) {
        console.error(error);
      }
    }

    function renderOutputs(outputs) {
      const outputsContainer = $('#outputsContainer');
      outputsContainer.empty();

      outputs.forEach((output) => {
        const outputContainer = $('<div>', { class: 'output-container' });
        const outputLabel = $('<label>').text(`Output ${output.outputIndex}`);
        const onButton = $('<button>', {
          class: 'on-button',
          text: 'ON',
          click: () => updateOutput(output.boardId, output.outputIndex, 'on')
        });
        const offButton = $('<button>', {
          class: 'off-button',
          text: 'OFF',
          click: () => updateOutput(output.boardId, output.outputIndex, 'off')
        });

        outputContainer.append(outputLabel, onButton, offButton);
        outputsContainer.append(outputContainer);
      });
    }

    async function updateOutput(boardId, output, state) {
      try {
        const response = await fetch(`/${state}?id=${boardId}&output=${output}`);
        if (response.ok) {
          const message = await response.text();
          console.log(message);
        } else {
          throw new Error('Failed to update output');
        }
      } catch (error) {
        console.error(error);
      }
    }
  </script>
</body>
</html>
